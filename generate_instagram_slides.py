#!/usr/bin/env python3
"""
Скрипт для генерации 12 слайдов для Instagram
Белый текст на прозрачном фоне в формате PNG
"""
from PIL import Image, ImageDraw, ImageFont
import os

def create_slide(text, slide_number):
    """Создает один слайд с белым текстом на прозрачном фоне"""
    # Размеры для Instagram (квадрат: 1080x1080)
    width, height = 1080, 1080
    
    # Создаем изображение с прозрачным фоном (RGBA)
    img = Image.new('RGBA', (width, height), (0, 0, 0, 0))
    draw = ImageDraw.Draw(img)
    
    # Попробуем использовать стандартный шрифт
    try:
        # Для Windows
        font = ImageFont.truetype("arial.ttf", 42)
    except:
        try:
            # Для macOS
            font = ImageFont.truetype("/System/Library/Fonts/Arial.ttf", 42)
        except:
            try:
                # Для Linux
                font = ImageFont.truetype("/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf", 42)
            except:
                # Если ни один шрифт не найден, используем дефолтный
                font = ImageFont.load_default()
    
    # Разбиваем текст на строки для лучшего отображения
    lines = wrap_text(text, font, width - 60)  # отступы по 30 пикселей с каждой стороны
    
    # Вычисляем высоту текста
    line_height = font.getbbox("Ay")[3] - font.getbbox("Ay")[1]
    # Увеличиваем расстояние между строками
    line_spacing = int(line_height * 1.5)
    total_text_height = len(lines) * line_spacing
    
    # Начальная позиция текста (по центру)
    y = (height - total_text_height) // 2
    
    # Рисуем каждую строку
    for line in lines:
        # Вычисляем ширину строки для центрирования
        bbox = font.getbbox(line)
        text_width = bbox[2] - bbox[0]
        x = (width - text_width) // 2
        
        # Рисуем белый текст
        draw.text((x, y), line, fill=(255, 255, 255, 255), font=font)
        y += line_spacing
    
    # Сохраняем изображение
    filename = f"slide_{slide_number:02d}.png"
    img.save(filename, "PNG")
    print(f"Создан слайд: {filename}")

def wrap_text(text, font, max_width):
    """Разбивает текст на строки в зависимости от ширины"""
    lines = []
    words = text.split()
    
    if not words:
        return lines
    
    current_line = words[0]
    
    for word in words[1:]:
        # Проверяем, помещается ли слово в текущую строку
        test_line = current_line + " " + word
        bbox = font.getbbox(test_line)
        # Уменьшаем ширину для большего запаса
        if bbox[2] <= max_width * 0.85:
            current_line = test_line
        else:
            lines.append(current_line)
            current_line = word
    
    lines.append(current_line)
    return lines

def main():
    # Создаем директорию для слайдов, если её нет
    slides_dir = "instagram_slides"
    if not os.path.exists(slides_dir):
        os.makedirs(slides_dir)
    
    # Меняем директорию на папку со слайдами
    os.chdir(slides_dir)
    
    # Тексты для 12 слайдов на русском языке
    slides_text = [
        "Как сознание создает мир, который мы воспринимаем?\\nНаши умы не просто наблюдают за реальностью - они активно участвуют в ее создании через акты различения и распознавания.",
        
        "Теория когнитивного резонанса\\nПонимание не приходит через передачу информации, а происходит через резонанс между вашим внутренним состоянием и внешней информацией.",
        
        "Два контура сознания\\nАналоговый контур: интуитивный, текучий, довообразный\\nЦифровой контур: логичный, структурированный, вербальный",
        
        "Акт первичного различения\\nПрежде чем знание может существовать, сознание должно отделить себя от того, что оно знает. Этот фундаментальный акт создает мир.",
        
        "От реальности к абстракции\\nНаблюдать → Описать → Определить → Назначить термин\\nПуть всех человеческих знаний",
        
        "Абстракция как основа\\nКонкретное → Общее → Абстрактное → Трансцендентное\\nЛестница человеческого понимания",
        
        "Шестой человеческий уровень\\nПереход от внешнего закона ко внутреннему\\nНастоящая автономия через самоопределение",
        
        "Минус-пространство: Реальность до пространственных различий\\nИсточник, из которого возникают пространство и время\\nЧистый потенциал, недифференцированное сознание",
        
        "Циклы понимания\\nЗнание спиралевидно движется вверх, а не линейно\\nКаждый виток приносит более глубокое понимание",
        
        "Человеческий путь через абстракцию\\nРазличать → Абстрагировать → Резонировать → Созерцать → Преобразовывать → Трансцендировать → Интегрировать",
        
        "За пределами пространства и времени\\nРеальность возникает из сознания, делающего различия\\nИзмените свои различия, измените свой мир",
        
        "Освойте алгоритмы мышления\\n27 исчерпывающих уроков, трансформирующих ваше понимание реальности, сознания и познания."
    ]
    
    # Создаем каждый слайд
    for i, text in enumerate(slides_text, 1):
        create_slide(text, i)
    
    print(f"Генерация {len(slides_text)} слайдов завершена!")

if __name__ == "__main__":
    main()