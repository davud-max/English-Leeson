/**
 * –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∑–∞–≤–∏—Å–∞–Ω–∏—è –∞—É–¥–∏–æ
 * –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ —É—Ä–æ–∫–∞ 1
 */

console.log('üéØ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∑–∞–≤–∏—Å–∞–Ω–∏—è –∞—É–¥–∏–æ —É—Ä–æ–∫–∞ 1\n');

console.log('## –î–∏–∞–≥–Ω–æ–∑ –ø—Ä–æ–±–ª–µ–º—ã:');
console.log('‚Ä¢ –ê—É–¥–∏–æ-—Ñ–∞–π–ª slide1.mp3 —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–µ–Ω');
console.log('‚Ä¢ –§–∞–π–ª –∑–∞—Ä–∞–±–æ—Ç–∞–ª –ø–æ—Å–ª–µ 10-–º–∏–Ω—É—Ç–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∞–Ω–∏—è');
console.log('‚Ä¢ –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ —Å–Ω–æ–≤–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–µ');
console.log('‚Ä¢ –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É –≤ –º–µ—Ö–∞–Ω–∏–∑–º–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è, –∞ –Ω–µ –≤ —Ñ–∞–π–ª–µ\n');

console.log('## –ü—Ä–∏—á–∏–Ω—ã –∑–∞–≤–∏—Å–∞–Ω–∏—è:');
console.log('1. –ë—Ä–∞—É–∑–µ—Ä —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∞—É–¥–∏–æ');
console.log('2. –ú–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞');
console.log('3. –ê—É–¥–∏–æ-—ç–ª–µ–º–µ–Ω—Ç –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏');
console.log('4. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞–¥–ª–µ–∂–∞—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏\n');

console.log('## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:');

const solutionCode = `
// 1. –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ
const [audioLoading, setAudioLoading] = useState(false);
const [audioReady, setAudioReady] = useState(false);

// 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∞—É–¥–∏–æ
const prepareAudio = (audioFile) => {
  return new Promise((resolve, reject) => {
    if (!audioRef.current) {
      reject(new Error('Audio element not available'));
      return;
    }

    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    audioRef.current.pause();
    audioRef.current.src = '';
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
    audioRef.current.src = audioFile;
    
    // –¢–∞–π–º–µ—Ä –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è
    const timeout = setTimeout(() => {
      reject(new Error('Audio preparation timeout'));
    }, 10000); // 10 —Å–µ–∫—É–Ω–¥
    
    // –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    audioRef.current.onloadedmetadata = () => {
      clearTimeout(timeout);
      setAudioReady(true);
      resolve();
    };
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    audioRef.current.onerror = (e) => {
      clearTimeout(timeout);
      reject(new Error('Failed to load audio metadata'));
    };
  });
};

// 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
const playAudio = async (audioFile) => {
  if (audioLoading) return;
  
  setAudioLoading(true);
  setAudioError(false);
  
  try {
    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ
    await prepareAudio(audioFile);
    
    // –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
    await audioRef.current.play();
    
    setAudioLoading(false);
    console.log('Audio playing successfully');
    
  } catch (error) {
    setAudioLoading(false);
    setAudioError(true);
    console.error('Audio playback failed:', error.message);
    
    // –ó–∞–ø—É—Å–∫ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    if (error.message.includes('timeout') || error.message.includes('metadata')) {
      // –ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π - –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ
      setTimeout(() => {
        if (isPlaying) {
          playAudio(audioFile);
        }
      }, 2000);
    } else {
      // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–π–º–µ—Ä
      const duration = slides[currentSlide]?.duration || 20000;
      timerRef.current = setTimeout(() => {
        if (currentSlide < totalSlides - 1) {
          setCurrentSlide(prev => prev + 1);
        } else {
          setIsPlaying(false);
        }
      }, duration);
    }
  }
};

// 4. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π useEffect
useEffect(() => {
  if (!isPlaying || !lesson) return;

  const audioFile = \`/audio/lesson\${lessonOrder}/slide\${currentSlide + 1}.mp3\`;
  
  // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–ª–∞–π–¥–∞
  setAudioReady(false);
  setAudioLoading(false);
  setAudioError(false);
  
  // –ó–∞–ø—É—Å–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
  playAudio(audioFile);

  return () => {
    if (timerRef.current) clearTimeout(timerRef.current);
    if (audioRef.current) {
      audioRef.current.pause();
      audioRef.current.src = ''; // –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
    }
  };
}, [currentSlide, isPlaying, lesson, lessonOrder]);
`;

console.log(solutionCode);

console.log('\n## –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:');
console.log('1. ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∞—É–¥–∏–æ-—ç–ª–µ–º–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–æ–π');
console.log('2. ‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º');
console.log('3. ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è');
console.log('4. ‚úÖ –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫');
console.log('5. ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫\n');

console.log('## –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–µ—à–∏—Ç –ø—Ä–æ–±–ª–µ–º—É:');
console.log('‚Ä¢ 10-–º–∏–Ω—É—Ç–Ω–æ–µ –∑–∞–≤–∏—Å–∞–Ω–∏–µ –±—ã–ª–æ —Å–≤—è–∑–∞–Ω–æ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö');
console.log('‚Ä¢ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∑–∞–≤–∏—Å–∞–Ω–∏–µ - –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è');
console.log('‚Ä¢ –ù–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–∂–¥—ã–π —Ä–∞–∑');
console.log('‚Ä¢ –°–∏—Å—Ç–µ–º–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ\n');

console.log('## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:');
console.log('1. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å');
console.log('2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∞—É–¥–∏–æ-—Ñ–∞–π–ª–æ–≤');
console.log('3. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "Retry" –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è');
console.log('4. –£—á–µ—Å—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤\n');

console.log('## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:');
console.log('–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:');
console.log('1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∞—É–¥–∏–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è —Å—Ä–∞–∑—É');
console.log('2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏–π');
console.log('3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö');
console.log('4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö');